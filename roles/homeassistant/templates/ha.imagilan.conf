server {  
    listen 80;
    listen [::]:80;
    server_name ha.imagilan;

    location /web-screensaver {
        alias /var/lib/homeassistant/screensaver_root;
        # kill cache
        expires -1;
    }
   
    location ~ ^/random_resized_image/(?<width>\d+)/(?<image>.+)$ {
       image_filter resize $width -;
       image_filter_jpeg_quality 90; # Desired JPG quality
       image_filter_buffer 40M; # Will return 415 if image is bigger than this
       image_filter_interlace on; # For progressive JPG
       proxy_pass http://pigallery2.imagilan/api/gallery/random/$image;
       proxy_http_version  1.1;
       resolver 10.7.11.1;
    }

    location / {
        proxy_pass          http://127.0.0.1:8123/;
        proxy_http_version  1.1;
        proxy_set_header    Host             $host;
        proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;
        proxy_set_header    Upgrade          $http_upgrade;
        proxy_set_header    Connection       upgrade;
    }
}